const express = require("express");
const cors = require("cors");
const axios = require("axios");
require("dotenv").config();

const app = express();
app.use(cors());
app.use(express.json());

const GROQ_API_KEY = process.env.GROQ_API_KEY;

app.post("/chat", async (req, res) => {
  const userMessage = req.body.messages[req.body.messages.length - 1].content;

  try {
    const response = await axios.post(
      "https://api.groq.com/openai/v1/chat/completions",
      {
        model: "llama3-70b-8192",
        messages: [
                    {
                      role: "system",
                      content: ` à´¨à´®à´¸àµà´•à´¾à´°à´‚! à´¨à´¿à´™àµà´™àµ¾ à´®àµà´Ÿàµà´Ÿà´‚ à´•àµŠà´•àµà´•à´¨à´Ÿàµà´Ÿàµ à´“à´¯à´¿àµ½ à´®à´¿àµ½-à´¨àµà´±àµ† à´”à´¦àµà´¯àµ‹à´—à´¿à´• à´šà´¾à´±àµà´±àµà´¬àµ‹à´Ÿàµà´ŸàµÂ  à´†à´£àµ.
                      à´¤à´¾à´´àµ† à´ªà´±à´¯àµà´¨àµà´¨ à´µà´¿à´·à´¯à´™àµà´™à´³à´¿àµ½ à´®à´¾à´¤àµà´°à´®à´¾à´£àµ à´¨à´¿à´™àµà´™àµ¾ à´šàµ‹à´¦àµà´¯à´™àµà´™àµ¾à´•àµà´•àµ à´®à´±àµà´ªà´Ÿà´¿ à´¨àµ½à´•àµ‡à´£àµà´Ÿà´¤àµ:
                      à´®àµà´Ÿàµà´Ÿà´‚ à´“à´¯à´¿àµ½ à´®à´¿à´²à´¿à´¨àµà´±àµ† à´‰àµ½à´ªàµà´ªà´¨àµà´¨à´™àµà´™àµ¾â€¢ à´ªà´¾à´°à´®àµà´ªà´°àµà´¯ à´¨à´¾à´Ÿàµ» à´­à´•àµà´·àµà´¯à´µà´¸àµà´¤àµà´•àµà´•àµ¾â€¢ à´µà´¿à´², à´“àµ¼à´¡àµ¼ à´šàµ†à´¯àµà´¯àµ‡à´£àµà´Ÿ à´µà´¿à´§à´‚ (WhatsApp à´µà´´à´¿)â€¢ à´‰àµ½à´ªàµà´ªà´¨àµà´¨à´™àµà´™à´³àµà´Ÿàµ† à´‰à´ªà´¯àµ‹à´—à´‚, à´†à´°àµ‹à´—àµà´¯ à´—àµà´£à´™àµà´™àµ¾â€¢ à´µà´¿à´²à´¾à´¸à´‚, à´«àµ‹àµº, à´‡à´®àµ†à´¯à´¿àµ½, à´ªàµà´°à´µàµ¼à´¤àµà´¤à´¨ à´¸à´®à´¯à´™àµà´™àµ¾
                      à´‡à´¤à´¿àµ½à´ªàµ†à´Ÿàµà´Ÿà´¿à´Ÿàµà´Ÿà´¿à´²àµà´²à´¾à´¤àµà´¤ à´µà´¿à´·à´¯à´™àµà´™à´³à´¿àµ½ à´¨à´¿à´™àµà´™àµ¾ à´®à´±àµà´ªà´Ÿà´¿ à´¨àµ½à´•à´°àµà´¤àµ.à´°à´¾à´·àµà´Ÿàµà´°àµ€à´¯, à´¤à´¤àµà´¤àµà´µà´šà´¿à´¨àµà´¤, à´µà´¿à´¦àµà´¯à´¾à´­àµà´¯à´¾à´¸à´‚, à´ªàµà´°à´£à´¯à´‚, à´•à´¾à´¯à´¿à´•à´‚, à´°à´¾à´·àµà´Ÿàµà´°àµ€à´¯ à´¨àµ‡à´¤à´¾à´•àµà´•àµ¾ à´¤àµà´Ÿà´™àµà´™à´¿à´¯à´µà´¯àµ† à´•àµà´±à´¿à´šàµà´šàµà´³àµà´³ à´šàµ‹à´¦àµà´¯à´™àµà´™àµ¾à´•àµà´•àµ à´®à´±àµà´ªà´Ÿà´¿ à´ªà´±à´¯à´°àµà´¤àµ.
                      à´®à´±àµà´ªà´Ÿà´¿à´•àµ¾ à´®à´²à´¯à´¾à´³à´¤àµà´¤à´¿àµ½ (Unicode à´®à´²à´¯à´¾à´³à´‚) à´®à´¾à´¤àµà´°à´®à´¾à´¯à´¿ à´¨àµ½à´•àµà´•. à´Žà´¨àµà´¤àµ†à´™àµà´•à´¿à´²àµà´‚ à´µà´¾à´•àµà´•àµ à´†à´µà´¶àµà´¯à´®àµ†à´™àµà´•à´¿àµ½ à´®à´¾à´¤àµà´°à´‚ à´‡à´‚à´—àµà´²àµ€à´·à´¿àµ½ à´‰àµ¾à´ªàµà´ªàµ†à´Ÿàµà´¤àµà´¤à´¾à´‚.                     à´®à´¾à´±àµà´±àµà´°à´¿à´¤à´®à´¾à´¯, à´µà´¿à´¨àµ€à´¤à´®à´¾à´¯ à´­à´¾à´·à´¯à´¿à´²à´¾à´¯à´¿à´°à´¿à´•àµà´•à´£à´‚.
                      à´‰àµ½à´ªàµà´ªà´¨àµà´¨à´™àµà´™àµ¾:
                      1.)à´µàµ†à´³à´¿à´šàµà´šàµ†à´£àµà´£ â€“ 1L(à´¶àµà´¦àµà´§à´®à´¾à´¯ 1 à´²à´¿à´±àµà´±àµ¼ à´¤àµ‡à´™àµà´™à´¾ à´Žà´£àµà´£),2.) à´µàµ†à´³à´¿à´šàµà´šàµ†à´£àµà´£ â€“ 500ml: (500 à´®à´¿à´²àµà´²à´¿ à´¬àµ‹à´Ÿàµà´Ÿà´¿à´²à´¿à´²àµà´³àµà´³ à´Žà´£àµà´£),3.)ðŸ¥¥ à´•àµŠà´ªàµà´°: à´‰à´£à´•àµà´•à´¿à´¯ à´¤àµ‡à´™àµà´™,4.) à´ªà´¿à´£àµà´£à´¾à´•àµà´•àµ: à´®àµƒà´—à´™àµà´™àµ¾à´•àµà´•àµ à´­à´•àµà´·à´£à´®à´¾à´¯à´¿ à´‰à´ªà´¯àµ‹à´—à´¿à´•àµà´•à´¾à´µàµà´¨àµà´¨ à´ªà´¿à´£àµà´£à´¾à´•àµà´•àµ
                      5.)à´…à´µà´²àµ‹à´¸àµ à´ªàµŠà´Ÿà´¿ ,6.) à´…à´µà´²àµ‹à´¸àµ à´‰à´£àµà´Ÿ,7.) à´ªàµà´Ÿàµà´Ÿàµà´ªàµŠà´Ÿà´¿,8.)à´…à´°à´¿ à´ªàµŠà´Ÿà´¿, 9.) à´—àµ‹à´¤à´®àµà´ªàµ à´ªàµŠà´Ÿà´¿, 10.)ðŸŒ¶ï¸ à´®àµà´³à´•àµà´ªàµŠà´Ÿà´¿,11.) à´•à´¾à´¶àµà´®àµ€à´°à´¿ à´®àµà´³à´•àµà´ªàµŠà´Ÿà´¿,12.) à´®à´žàµà´žàµ¾ à´ªàµŠà´Ÿà´¿,13.) à´®à´²àµà´²à´¿à´ªàµà´ªàµŠà´Ÿà´¿ ,14.)à´¤àµ‡àµ», 15.) à´¨àµ†à´¯àµ, 16.)à´•àµà´Ÿà´‚à´ªàµà´³à´¿, 17.)à´µà´¾à´³àµ»à´ªàµà´³à´¿, 18.) à´¨à´¾à´Ÿàµ» à´•àµà´¤àµà´¤à´°à´¿ â€“ 50% à´¤à´µà´¿à´Ÿàµ, 20% à´¤à´µà´¿à´Ÿàµ
                      à´µà´¿à´²à´¾à´¸à´‚:Muttom Coconut Oil MillsKarimpanakulam, Manimala, Kerala 686544ðŸ“ž
                      phone no: +91 9846444667, email:muttomcoconutoil@gmail.com, working time(à´¸à´®à´¯à´‚): à´¤à´¿à´™àµà´•àµ¾â€“à´¶à´¨à´¿: 9 AM â€“ 6:30 PM, à´žà´¾à´¯àµ¼: à´…à´Ÿà´šàµà´šà´¿à´°à´¿à´•àµà´•àµà´‚
                      WhatsApp à´µà´´à´¿ à´“àµ¼à´¡àµ¼ à´šàµ†à´¯àµà´¯à´¾àµ»: https://wa.me/6282456869
                      à´ˆ à´µà´¿à´µà´°à´™àµà´™àµ¾ à´…à´Ÿà´¿à´¸àµà´¥à´¾à´¨à´®à´¾à´•àµà´•à´¿à´¯àµà´³àµà´³ à´¸à´‚à´¶à´¯à´™àµà´™àµ¾à´•àµà´•à´¾à´£àµ à´¨à´¿à´™àµà´™àµ¾ à´®à´±àµà´ªà´Ÿà´¿ à´¨àµ½à´•àµ‡à´£àµà´Ÿà´¤àµ.à´®à´±àµà´±àµ†à´¨àµà´¤àµ†à´™àµà´•à´¿à´²àµà´‚ à´šàµ‹à´¦à´¿à´•àµà´•àµà´®àµà´ªàµ‹àµ¾, à´¸àµ—à´®àµà´¯à´®à´¾à´¯à´¿ à´µàµ†à´±àµà´¤àµ† à´®à´¾à´ªàµà´ªàµ à´ªà´±à´¯àµà´• ðŸ™
                      âŒ à´®àµà´Ÿàµà´Ÿà´‚ à´“à´¯à´¿àµ½ à´®à´¿àµ½-à´¸à´‚à´¬à´¨àµà´§à´®à´²àµà´²à´¾à´¤àµà´¤ à´šàµ‹à´¦àµà´¯à´™àµà´™àµ¾à´•àµà´•àµ à´¨à´¿à´™àµà´™àµ¾ à´®à´±àµà´ªà´Ÿà´¿ à´ªà´±à´¯à´°àµà´¤àµ.
                      à´‡à´¤àµ à´²à´‚à´˜à´¿à´šàµà´šà´¾àµ½, à´¦à´¯à´µà´¾à´¯à´¿ à´ˆ à´µà´¾à´•àµà´¯à´‚ à´®à´¾à´¤àµà´°à´‚ à´®à´±àµà´ªà´Ÿà´¿ à´¨àµ½à´•àµà´•:  "à´•àµà´·à´®à´¿à´•àµà´•à´£à´‚, à´ˆ à´µà´¿à´µà´°à´™àµà´™àµ¾ à´Žà´¨àµà´±àµ† à´ªà´°à´¿à´§à´¿à´¯à´¿à´²à´²àµà´² ðŸ™
                      Do not respond to any questions related to price.say only contact on whatsapp for price."
                      `},

                    {
                      role: "user",
                      content: userMessage
                    }
                  ],
        temperature: 1,
        max_tokens: 1024,
        top_p: 1,
        stream: false
      },
      {
        headers: {
          Authorization: `Bearer ${GROQ_API_KEY}`,
          "Content-Type": "application/json"
        }
      }
    );

    res.json({ choices: [{ message: { content: response.data.choices[0].message.content } }] });
  } catch (err) {
    console.error("Groq API error:", err.response?.data || err.message);
    res.status(500).json({ error: "Failed to fetch from Groq API." });
  }
});

app.listen(3000, () => {
  console.log("ðŸš€ Groq LLaMA 3 chatbot running at http://localhost:3000");
});
